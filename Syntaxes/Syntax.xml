<?xml version="1.0"?>
<syntax name="sourcecode.ruby">
  <zones>
    <include collection="container.expressions.basic"/>
  </zones>
  <library>
    
    <collection name="container.expressions.basic">
      <!--
        This is the basic "expression" into which most Ruby will fall. It's
        simply any line of code, terminated by a semicolon or end of line.
      -->
      <zone name="container.expression">
        <starts-with>
          <expression></expression>
          <capture number="0" name="container.expression.begin"/>
        </starts-with>
        <ends-with>
          <expression>(?:(\n$)|(;))</expression>
          <capture number="0" name="container.expression.end"/>
          <capture number="2" name="container.expression.terminator"/>
        </ends-with>
        <subzones>
          <include collection="container.expressions.subzones"/>
        </subzones>
      </zone>
    </collection>
    <collection name="container.expressions.subzones">
      <include collection="container.expressions.other"/>
    </collection>
    
    <collection name="container.expressions.other">
      <zone name="container.expression.parenthetical">
        <starts-with>
          <expression>\(</expression>
          <capture number="0" name="delimiter.balanced.parenthesis.begin"/>
        </starts-with>
        <ends-with>
          <expression>\)</expression>
          <capture number="0" name="delimiter.balanced.parenthesis.end"/>
        </ends-with>
        <subzones>
          <include collection="container.expressions.subzones"/>
        </subzones>
      </zone>
      <include collection="identifier.function.call"/>
    </collection>
    
    <collection name="identifier.function.call">
      <zone name="identifier.function.call.parenthetical">
        <starts-with>
          <expression>\s*(\.)?\s*([a-zA-Z_][A-Za-z0-9_]*(?:[\?\!]|[ \t]*\=[ \t]*)?)\s*(\()</expression>
          <!-- Extending delimiter with x-call -->
          <capture number="1" name="operator.x-call.function"/>
          <capture number="2" name="name"/>
          <capture number="3" name="delimiter.x-parameters.function.balanced.parenthesis.begin"/>
        </starts-with>
        <ends-with>
          <expression>\)</expression>
          <capture number="0" name="delimiter.x-parameters.function.balanced.parenthesis.end"/>
        </ends-with>
        <subzones>
          
        </subzones>
      </zone>
      <zone name="identifier.function.call.whitespace-delimited">
        <starts-with>
          <expression>\s*(\.)?\s*([a-zA-Z_][A-Za-z0-9_]*[\?\!\=]?)([ \t]+)</expression>
          <!-- Extending delimiter with x-call -->
          <capture number="1" name="operator.x-call.function"/>
          <capture number="2" name="name"/>
          <!-- Extending delimiter with x-parameters -->
          <capture number="3" name="delimiter.x-parameters.function.begin"/>
        </starts-with>
        <ends-with>
          <expression>\n$</expression>
          <!-- Extending delimiter with x-parameters -->
          <capture number="0" name="delimiter.x-parameters.function.begin"/>
        </ends-with>
        <subzones>
          <include collection="identifier.variable.parameter"/>
        </subzones>
      </zone>
    </collection>
    
  </library>
</syntax>
